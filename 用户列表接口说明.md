# 用户列表接口说明

## 📡 接口信息

### GET /user/list

#### 基本信息
- **URL**: `/user/list`
- **方法**: `GET`
- **认证**: 需要 token

#### 请求参数 (Query Parameters)
```javascript
{
  page: 1,           // 页码（必填）
  pageSize: 10,      // 每页数量（必填）
  username: '',      // 用户名（可选）
  email: '',         // 邮箱（可选）
  role: null         // 角色（可选，1:普通用户 2:教师 3:系统管理员）
}
```

#### 响应格式
```java
Result<List<RedisUser>>

{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 5,
      "username": "xhonell",
      "email": "xhonell@163.com",
      "phone": "18996459789",
      "avatarId": 11,
      "avatarUrl": "https://pe-1329896228.cos.ap-chengdu.myqcloud.com/images/...",
      "role": 2,                      // 1:普通用户 2:教师 3:系统管理员
      "status": false,                // true:启用 false:禁用
      "createTime": "2025-10-19T23:16:01",
      "updateTime": "2025-10-19T23:16:34"
    }
  ]
}
```

## 🔍 字段说明

### RedisUser 实体类
```java
@Data
@AllArgsConstructor
@NoArgsConstructor
@Accessors(chain = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class RedisUser {
    private Long id;                    // 用户ID
    private String username;            // 用户名
    private String email;               // 邮箱
    private LocalDateTime createTime;   // 创建时间
    private LocalDateTime updateTime;   // 更新时间
    private Integer role;               // 角色（1:普通用户 2:教师 3:系统管理员）
    private Long avatarId;              // 头像ID
    private String phone;               // 手机号
    private Boolean status;             // 状态（true:启用 false:禁用）
    private String avatarUrl;           // 头像URL
}
```

### 角色说明
| role值 | 角色名称 | 说明 |
|--------|---------|------|
| 1 | 普通用户 | 基本权限 |
| 2 | 教师 | 教学权限 |
| 3 | 系统管理员 | 最高权限 |

### 状态说明
| status | 状态 | 说明 |
|--------|------|------|
| true | 启用 | 账号正常使用 |
| false | 禁用 | 账号被禁用 |

## 💻 前端实现

### 1. API 接口定义
```javascript
// src/api/user.js
import request from '@/utils/request'

export function getUserList(params) {
  return request({
    url: '/user/list',
    method: 'get',
    params  // { page, pageSize, username, email, role }
  })
}
```

### 2. 页面调用
```javascript
// src/views/user/list.vue
import { getUserList } from '@/api/user'

// 加载用户列表
const loadUserList = async () => {
  loading.value = true
  try {
    const params = {
      page: pagination.page,
      pageSize: pagination.pageSize,
      username: searchForm.username,
      email: searchForm.email,
      role: searchForm.role
    }
    
    const data = await getUserList(params)
    userList.value = data
  } catch (error) {
    ElMessage.error('获取用户列表失败')
  } finally {
    loading.value = false
  }
}
```

### 3. 分页参数
```javascript
const pagination = reactive({
  page: 1,        // 当前页码
  pageSize: 10,   // 每页数量
  total: 0        // 总数（需要后端返回）
})

// 页码改变
const handleCurrentChange = (page) => {
  pagination.page = page
  loadUserList()
}

// 每页数量改变
const handleSizeChange = (size) => {
  pagination.pageSize = size
  pagination.page = 1
  loadUserList()
}
```

### 4. 搜索功能
```javascript
const searchForm = reactive({
  username: '',
  email: '',
  role: ''
})

// 搜索
const handleSearch = () => {
  pagination.page = 1
  loadUserList()
}

// 重置
const handleReset = () => {
  searchForm.username = ''
  searchForm.email = ''
  searchForm.role = ''
  pagination.page = 1
  loadUserList()
}
```

## 🎨 表格显示

### 表格列配置
```vue
<el-table :data="userList" v-loading="loading">
  <el-table-column prop="id" label="用户ID" width="80" />
  
  <!-- 头像 -->
  <el-table-column label="头像" width="80">
    <template #default="{ row }">
      <el-avatar :src="row.avatarUrl" />
    </template>
  </el-table-column>
  
  <!-- 用户名 -->
  <el-table-column prop="username" label="用户名" />
  
  <!-- 邮箱 -->
  <el-table-column prop="email" label="邮箱" />
  
  <!-- 手机号 -->
  <el-table-column prop="phone" label="手机号" />
  
  <!-- 角色 -->
  <el-table-column prop="role" label="角色">
    <template #default="{ row }">
      <el-tag :type="getRoleType(row.role)">
        {{ getRoleName(row.role) }}
      </el-tag>
    </template>
  </el-table-column>
  
  <!-- 创建时间 -->
  <el-table-column prop="createTime" label="创建时间">
    <template #default="{ row }">
      {{ formatTime(row.createTime) }}
    </template>
  </el-table-column>
  
  <!-- 状态 -->
  <el-table-column prop="status" label="状态">
    <template #default="{ row }">
      <el-switch v-model="row.status" @change="handleStatusChange(row)" />
    </template>
  </el-table-column>
  
  <!-- 操作 -->
  <el-table-column label="操作" fixed="right">
    <template #default="{ row }">
      <el-button text @click="handleView(row)">查看</el-button>
      <el-button text @click="handleEdit(row)">编辑</el-button>
      <el-button text @click="handleDelete(row)">删除</el-button>
    </template>
  </el-table-column>
</el-table>
```

## 📊 完整请求示例

### 基本请求
```javascript
// GET /user/list?page=1&pageSize=10
await getUserList({
  page: 1,
  pageSize: 10
})
```

### 带搜索条件
```javascript
// GET /user/list?page=1&pageSize=10&username=xhonell&role=2
await getUserList({
  page: 1,
  pageSize: 10,
  username: 'xhonell',
  role: 2
})
```

### 响应数据处理
```javascript
const data = await getUserList(params)

// 假设响应格式
{
  code: 200,
  message: 'success',
  data: [
    { id: 1, username: '...', ... },
    { id: 2, username: '...', ... }
  ]
}

// 设置表格数据
userList.value = data
```

## 🔧 工具函数

### 角色名称转换
```javascript
import { getRoleName } from '@/types/user'

getRoleName(1)  // "普通用户"
getRoleName(2)  // "教师"
getRoleName(3)  // "系统管理员"
```

### 时间格式化
```javascript
import { formatTime } from '@/types/user'

formatTime('2025-10-19T23:16:01')  // "2025-10-19 23:16"
```

### 角色标签类型
```javascript
const getRoleType = (role) => {
  const types = {
    1: 'info',     // 普通用户 - 灰色
    2: 'warning',  // 教师 - 橙色
    3: 'danger'    // 系统管理员 - 红色
  }
  return types[role] || 'info'
}
```

## 📝 后端分页说明

### PageUtils.startPage
```java
// 后端使用 PageHelper 分页
PageUtils.startPage(request.getPage(), request.getPageSize());
List<RedisUser> list = userService.selectList(request);
```

### 分页参数
- `page`: 页码（从1开始）
- `pageSize`: 每页数量

### 注意事项
1. 前端传递 `page` 和 `pageSize` 参数
2. 后端自动分页处理
3. 前端需要显示总数，可能需要后端返回 total

## ⚠️ 常见问题

### 1. 分页总数获取
**问题**: 如何获取总记录数？

**方案1**: 后端返回分页信息
```java
Result<PageInfo<RedisUser>>
{
  code: 200,
  data: {
    list: [...],
    total: 100,
    pageNum: 1,
    pageSize: 10
  }
}
```

**方案2**: 响应头返回
```
X-Total-Count: 100
```

前端获取：
```javascript
response.headers['x-total-count']
```

### 2. 请求参数为空
确保空值不发送：
```javascript
const params = {
  page: pagination.page,
  pageSize: pagination.pageSize
}

// 只添加非空参数
if (searchForm.username) params.username = searchForm.username
if (searchForm.email) params.email = searchForm.email
if (searchForm.role) params.role = searchForm.role
```

### 3. 时间格式
后端返回 ISO 8601 格式：`2025-10-19T23:16:01`
前端需要格式化显示：`2025-10-19 23:16`

## ✅ 功能清单

- [x] 获取用户列表接口
- [x] 分页功能
- [x] 搜索功能（用户名、邮箱、角色）
- [x] 角色标签显示
- [x] 头像显示
- [x] 时间格式化
- [x] 状态切换
- [x] 删除用户
- [x] 表格加载状态

## 🚀 测试步骤

1. 启动后端服务（8801端口）
2. 启动前端：`npm run dev`
3. 登录系统
4. 点击"用户管理" → "用户列表"
5. 查看用户列表数据
6. 测试搜索功能
7. 测试分页功能
8. 测试状态切换

---

**用户列表接口对接完成！** 👥✨

