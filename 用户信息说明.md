# 用户信息数据结构说明

## 📋 后端返回的用户信息

### 数据结构
```javascript
{
  id: 5,                    // 用户ID
  username: "xhonell",      // 用户名
  email: "xhonell@163.com", // 邮箱
  phone: "18996459789",     // 手机号
  avatarId: 11,             // 头像ID
  avatarUrl: "https://pe-1329896228.cos.ap-chengdu.myqcloud.com/images/3bf592d79f9d4c049d00ecf3b6dd83c2.jpg", // 头像URL
  role: 2,                  // 角色（1:管理员, 2:普通用户）
  status: false,            // 账号状态（true:启用, false:禁用）
  createTime: "2025-10-19T23:16:01",   // 创建时间
  updateTime: "2025-10-19T23:16:34"    // 更新时间
}
```

## 🔍 字段说明

### 基本信息
| 字段 | 类型 | 说明 | 示例 |
|------|------|------|------|
| id | number | 用户唯一标识 | 5 |
| username | string | 用户名 | xhonell |
| email | string | 邮箱地址 | xhonell@163.com |
| phone | string | 手机号码 | 18996459789 |

### 头像信息
| 字段 | 类型 | 说明 | 示例 |
|------|------|------|------|
| avatarId | number | 头像ID（关联头像表） | 11 |
| avatarUrl | string | 头像URL（完整地址） | https://... |

### 权限信息
| 字段 | 类型 | 说明 | 可选值 |
|------|------|------|--------|
| role | number | 用户角色 | 1:管理员, 2:普通用户 |
| status | boolean | 账号状态 | true:启用, false:禁用 |

### 时间信息
| 字段 | 类型 | 说明 | 格式 |
|------|------|------|------|
| createTime | string | 创建时间 | ISO 8601 格式 |
| updateTime | string | 更新时间 | ISO 8601 格式 |

## 💻 前端使用

### 1. 获取用户信息
```javascript
import { getUserInfo } from '@/api/login'

// 登录后获取
const userInfo = await getUserInfo()

// 保存到 localStorage
localStorage.setItem('userInfo', JSON.stringify(userInfo))

// 读取
const userInfoStr = localStorage.getItem('userInfo')
const userInfo = JSON.parse(userInfoStr)
```

### 2. 显示用户头像
```vue
<el-avatar :src="userInfo.avatarUrl" :size="36" />
```

### 3. 显示用户名
```vue
<span>{{ userInfo.username }}</span>
```

### 4. 显示邮箱
```vue
<span>{{ userInfo.email }}</span>
```

### 5. 判断角色
```javascript
import { isAdmin, getRoleName } from '@/types/user'

// 是否为管理员
if (isAdmin(userInfo.role)) {
  console.log('用户是管理员')
}

// 获取角色名称
const roleName = getRoleName(userInfo.role) // "普通用户"
```

### 6. 显示账号状态
```vue
<el-tag :type="userInfo.status ? 'success' : 'danger'">
  {{ userInfo.status ? '正常' : '禁用' }}
</el-tag>
```

### 7. 格式化时间
```javascript
import { formatTime } from '@/types/user'

const time = formatTime(userInfo.createTime)
// "2025-10-19 23:16"
```

## 🎨 布局中的应用

### 顶部用户信息
```vue
<template>
  <div class="user-info">
    <!-- 头像 -->
    <el-avatar :size="36" :src="userAvatar" />
    
    <!-- 用户名 -->
    <span class="username">{{ userDisplayName }}</span>
    
    <!-- 下拉菜单 -->
    <el-dropdown>
      <el-icon><ArrowDown /></el-icon>
      <template #dropdown>
        <el-dropdown-menu>
          <!-- 用户信息 -->
          <el-dropdown-item disabled>
            <div>{{ userInfo.username }}</div>
            <div>{{ userInfo.email }}</div>
          </el-dropdown-item>
          <!-- 菜单项 -->
          <el-dropdown-item command="profile">个人中心</el-dropdown-item>
          <el-dropdown-item command="logout">退出登录</el-dropdown-item>
        </el-dropdown-menu>
      </template>
    </el-dropdown>
  </div>
</template>

<script>
import { computed, ref } from 'vue'

export default {
  setup() {
    const userInfo = ref({})
    
    // 读取用户信息
    const getUserInfoFromStorage = () => {
      const userInfoStr = localStorage.getItem('userInfo')
      if (userInfoStr) {
        userInfo.value = JSON.parse(userInfoStr)
      }
    }
    
    // 头像URL
    const userAvatar = computed(() => {
      return userInfo.value.avatarUrl || '默认头像URL'
    })
    
    // 显示名称
    const userDisplayName = computed(() => {
      return userInfo.value.username || '未登录'
    })
    
    getUserInfoFromStorage()
    
    return {
      userInfo,
      userAvatar,
      userDisplayName
    }
  }
}
</script>
```

## 📊 数据示例

### 管理员用户
```json
{
  "id": 1,
  "username": "admin",
  "email": "admin@example.com",
  "phone": "13800138000",
  "avatarId": 1,
  "avatarUrl": "https://example.com/avatar/admin.jpg",
  "role": 1,
  "status": true,
  "createTime": "2025-01-01T00:00:00",
  "updateTime": "2025-01-01T00:00:00"
}
```

### 普通用户
```json
{
  "id": 5,
  "username": "xhonell",
  "email": "xhonell@163.com",
  "phone": "18996459789",
  "avatarId": 11,
  "avatarUrl": "https://pe-1329896228.cos.ap-chengdu.myqcloud.com/images/3bf592d79f9d4c049d00ecf3b6dd83c2.jpg",
  "role": 2,
  "status": false,
  "createTime": "2025-10-19T23:16:01",
  "updateTime": "2025-10-19T23:16:34"
}
```

## ⚙️ 工具函数

### 类型定义文件
创建 `src/types/user.js`：
```javascript
// 角色枚举
export const UserRole = {
  ADMIN: 1,
  USER: 2
}

// 角色名称
export const UserRoleNames = {
  1: '管理员',
  2: '普通用户'
}

// 获取角色名称
export function getRoleName(role) {
  return UserRoleNames[role] || '未知角色'
}

// 判断是否为管理员
export function isAdmin(role) {
  return role === UserRole.ADMIN
}

// 格式化时间
export function formatTime(time) {
  if (!time) return ''
  const date = new Date(time)
  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`
}

// 获取状态文本
export function getStatusText(status) {
  return status ? '正常' : '禁用'
}
```

## 🔐 权限控制

### 基于角色的权限
```javascript
// 检查是否有权限
function hasPermission(requiredRole) {
  const userInfo = JSON.parse(localStorage.getItem('userInfo'))
  return userInfo && userInfo.role <= requiredRole
}

// 使用
if (hasPermission(UserRole.ADMIN)) {
  // 显示管理员功能
}
```

### 路由守卫
```javascript
router.beforeEach((to, from, next) => {
  const userInfo = JSON.parse(localStorage.getItem('userInfo'))
  
  if (to.meta.requiresAdmin && userInfo.role !== 1) {
    ElMessage.error('需要管理员权限')
    next(false)
  } else {
    next()
  }
})
```

## 📝 注意事项

1. **头像URL**: 如果没有头像URL，使用默认头像
2. **角色判断**: role=1 是管理员，role=2 是普通用户
3. **账号状态**: status=false 表示账号被禁用
4. **时间格式**: ISO 8601 格式，需要格式化后显示
5. **敏感信息**: 不要在前端存储密码等敏感信息

## 🎯 已实现功能

- ✅ 登录后获取用户信息
- ✅ 保存到 localStorage
- ✅ 顶部显示用户头像
- ✅ 顶部显示用户名
- ✅ 下拉菜单显示邮箱
- ✅ 退出登录清除用户信息
- ✅ 创建用户类型定义文件

## 📂 相关文件

- `src/layout/index.vue` - 顶部用户信息显示
- `src/views/login/index.vue` - 登录后保存用户信息
- `src/types/user.js` - 用户类型定义和工具函数
- `src/api/login.js` - 获取用户信息接口

---

**用户信息已完整对接！** 👤✨

