# 登录接口测试文档

## 📡 接口信息

### 基本信息
- **接口地址**: `http://localhost:8801/login/login`
- **请求方式**: `POST`
- **Content-Type**: `application/json`
- **认证要求**: 无需认证（@NoAuth）

## 📤 请求格式

### 请求头 (Headers)
```
Content-Type: application/json
```

### 请求体 (Body - JSON)
```json
{
  "email": "admin@example.com",
  "password": "123456"
}
```

**字段说明**：
- `email`: 邮箱（必填，需符合邮箱格式）
- `password`: 密码（必填，6-20个字符）

### 完整的 curl 命令
```bash
curl -X POST http://localhost:8801/admin/login/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "123456"
  }'
```

## 📥 响应格式

### 成功响应
```json
{
  "code": 200,
  "message": "success",
  "data": "eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTY..."
}
```

### 失败响应
```json
{
  "code": 401,
  "message": "用户名或密码错误",
  "data": null
}
```

## 🔧 前端配置

### 1. API 接口定义 (src/api/login.js)
```javascript
import request from '@/utils/request'

export function login(data) {
  return request({
    url: '/login/login',
    method: 'post',
    data  // 自动转换为 JSON
  })
}
```

### 2. Axios 配置 (src/utils/request.js)
```javascript
const service = axios.create({
  baseURL: '/api',  // 通过代理转发
  timeout: 15000,
  headers: {
    'Content-Type': 'application/json;charset=utf-8'  // JSON 格式
  }
})
```

### 3. Vite 代理配置 (vite.config.js)
```javascript
proxy: {
  '/api': {
    target: 'http://localhost:8801',  // 后端服务器
    changeOrigin: true,
    rewrite: (path) => path.replace(/^\/api/, '')
  }
}
```

## 🎯 前端调用示例

### Vue 组件中调用
```javascript
import { login } from '@/api/login'

// 方式1: async/await
async function handleLogin() {
  try {
    const token = await login({
      username: 'admin',
      password: '123456'
    })
    console.log('登录成功，token:', token)
  } catch (error) {
    console.error('登录失败:', error)
  }
}

// 方式2: Promise
login({
  username: 'admin',
  password: '123456'
})
.then(token => {
  console.log('登录成功，token:', token)
})
.catch(error => {
  console.error('登录失败:', error)
})
```

## 🧪 测试方法

### 方法1: 使用 Postman

1. **创建新请求**
   - Method: `POST`
   - URL: `http://localhost:8801/login/login`

2. **设置请求头**
   ```
   Content-Type: application/json
   ```

3. **设置请求体 (Body → raw → JSON)**
   ```json
   {
     "username": "admin",
     "password": "123456"
   }
   ```

4. **点击 Send 发送请求**

### 方法2: 使用 curl 命令

```bash
# Windows PowerShell
curl.exe -X POST http://localhost:8801/login/login `
  -H "Content-Type: application/json" `
  -d '{"username":"admin","password":"123456"}'

# Linux/Mac
curl -X POST http://localhost:8801/login/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}'
```

### 方法3: 浏览器开发者工具

1. 打开前端页面 `http://localhost:3000`
2. 按 F12 打开开发者工具
3. 切换到 Network 标签
4. 输入用户名密码，点击登录
5. 查看 `login` 请求详情

**查看请求信息**：
- Request Headers → Content-Type: application/json
- Request Payload → 可以看到 JSON 数据
- Response → 查看返回的数据

### 方法4: 使用浏览器控制台

```javascript
// 打开控制台（F12），粘贴以下代码

// 测试登录接口
fetch('http://localhost:8801/login/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    username: 'admin',
    password: '123456'
  })
})
.then(res => res.json())
.then(data => {
  console.log('响应数据:', data)
  if (data.code === 200) {
    console.log('登录成功! Token:', data.data)
  } else {
    console.log('登录失败:', data.message)
  }
})
.catch(error => {
  console.error('请求错误:', error)
})
```

## 🔍 请求流程分析

### 前端请求流程
```
1. 用户点击登录按钮
   ↓
2. 调用 login({ username, password })
   ↓
3. request.js 拦截器处理
   ↓
4. 发送 POST 请求到 /api/login/login
   ↓
5. Vite 代理转发到 http://localhost:8801/login/login
   ↓
6. 后端 Spring Boot 接收处理
   ↓
7. 返回 Result<String> (token)
   ↓
8. 前端接收响应
   ↓
9. 保存 token 到 localStorage
   ↓
10. 跳转到首页
```

### 请求数据格式
```javascript
// 前端发送
{
  username: 'admin',
  password: '123456'
}

// 转换为 JSON
"{"username":"admin","password":"123456"}"

// HTTP 请求体
POST /login/login HTTP/1.1
Host: localhost:8801
Content-Type: application/json
Content-Length: 47

{"username":"admin","password":"123456"}
```

## 📝 后端接口对应

### Spring Boot Controller
```java
@RestController
@RequestMapping("/login")
@RequiredArgsConstructor
public class LoginController {

    private final LoginService loginService;

    @PostMapping("/login")
    @NoAuth
    public Result<String> login(@Valid @RequestBody LoginRequest request) {
        String token = loginService.login(request);
        return Result.success(token);
    }
}
```

### LoginRequest 实体类
```java
@Data
public class LoginRequest {
    @Email(message = "邮箱格式不正确")
    @NotBlank(message = "邮箱不能为空")
    private String email;
    
    @NotBlank(message = "密码不能为空")
    @Size(min = 6, max = 20, message = "密码长度应在6-20个字符之间")
    private String password;
}
```

### Result 响应格式
```java
@Data
public class Result<T> {
    private Integer code;
    private String message;
    private T data;
}
```

## ⚠️ 常见问题

### 1. 请求发送但后端未收到
**检查项**：
- ✅ 后端服务是否启动（8801端口）
- ✅ Vite 代理配置是否正确
- ✅ 防火墙是否阻止

**解决方案**：
```bash
# 检查后端端口
netstat -ano | findstr "8801"

# 重启前端开发服务器
npm run dev
```

### 2. Content-Type 不是 JSON
**检查**：
- request.js 中的 headers 配置
- 确保设置了 `'Content-Type': 'application/json'`

### 3. 跨域问题
**现象**：
```
Access to fetch at 'http://localhost:8801/login/login' 
from origin 'http://localhost:3000' has been blocked by CORS
```

**解决**：
- ✅ 已配置 Vite 代理，通过 `/api` 访问
- ✅ 前端请求 `/api/login/login` 而不是直接请求 `http://localhost:8801`

### 4. 请求参数格式错误
**错误示例**：
```javascript
// ❌ 错误：直接传字符串
login('admin', '123456')

// ✅ 正确：传对象
login({ username: 'admin', password: '123456' })
```

## 📊 请求监控

### Chrome DevTools Network
1. 打开 DevTools (F12)
2. 切换到 Network 标签
3. 勾选 "Preserve log"
4. 执行登录操作

**查看内容**：
- General → Request URL, Method
- Request Headers → Content-Type
- Request Payload → JSON 数据
- Response → 返回数据

### Axios 请求日志
可以在 request.js 中添加日志：
```javascript
service.interceptors.request.use(config => {
  console.log('📤 发送请求:', config.method.toUpperCase(), config.url)
  console.log('📦 请求数据:', config.data)
  return config
})

service.interceptors.response.use(response => {
  console.log('📥 收到响应:', response.config.url)
  console.log('📋 响应数据:', response.data)
  return response.data
})
```

## ✅ 验证清单

登录接口测试前的检查项：

- [ ] 后端服务已启动（端口 8801）
- [ ] 前端服务已启动（端口 3000）
- [ ] Vite 代理配置正确
- [ ] Content-Type 设置为 application/json
- [ ] 请求体格式为 JSON 对象
- [ ] 用户名密码符合后端验证规则
- [ ] 网络连接正常

---

## 🎯 快速测试

### 1分钟快速测试步骤

```bash
# 1. 启动后端（确保在 8801 端口）
# 后端项目目录下执行
./mvnw spring-boot:run

# 2. 启动前端
# 前端项目目录下执行
npm run dev

# 3. 打开浏览器
http://localhost:3000

# 4. 输入账号密码
用户名: admin
密码: 123456

# 5. 点击登录，查看效果
```

**成功标志**：
✅ 提示"登录成功！"
✅ 跳转到首页
✅ localStorage 中有 token

---

**接口配置完成，可以开始测试了！** 🚀

