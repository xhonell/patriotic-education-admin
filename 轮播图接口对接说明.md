# 轮播图接口对接说明 🎠

## 📡 后端接口信息

### 控制器
```java
@RequestMapping("/banner")
@RequiredArgsConstructor
public class BannerController {
    private final BannerService bannerService;

    @GetMapping("/list")
    public Result<PageInfo<BannerResponse>> list(BannerPageRequest request) {
        return Result.success(bannerService.selectList(request));
    }
}
```

### 响应实体
```java
@Data
@AllArgsConstructor
@NoArgsConstructor
@Accessors(chain = true)
@JsonInclude(JsonInclude.Include.NON_NULL)
public class BannerResponse implements Serializable {
    private Long id;              // 轮播图ID
    private Long fileId;          // 文件ID
    private String filePathUrl;   // 图片地址
    private String title;         // 标题
    private Boolean status;       // 状态（true:启用, false:禁用）
    private LocalDateTime createTime;   // 创建时间
    private LocalDateTime updateTime;   // 更新时间
}
```

## 🔗 API 接口列表

### 1. 获取轮播图列表
```
GET /banner/list
```

#### 请求参数
```javascript
{
  page: 1,           // 页码
  pageSize: 10,      // 每页数量
  title: '',         // 标题（可选）
  status: null       // 状态（可选，true/false）
}
```

#### 响应格式
```javascript
{
  code: 200,
  message: "操作成功",
  data: {
    total: 10,       // 总记录数
    list: [          // 轮播图列表
      {
        id: 1,
        fileId: 100,
        filePathUrl: "https://example.com/banner/1.jpg",
        title: "庆祝国庆",
        status: true,
        createTime: "2025-10-20T22:31:00",
        updateTime: "2025-10-20T22:31:00"
      }
    ],
    pageNum: 1,      // 当前页
    pageSize: 10,    // 每页大小
    pages: 1         // 总页数
  }
}
```

### 2. 新增轮播图（预期）
```
POST /banner/add
```

#### 请求体
```javascript
{
  title: "标题",
  fileId: 100,
  status: true
}
```

### 3. 更新轮播图（预期）
```
PUT /banner/update
```

#### 请求体
```javascript
{
  id: 1,
  title: "标题",
  fileId: 100,
  status: true
}
```

### 4. 更新状态（预期）
```
PUT /banner/status/{id}
```

#### 请求体
```javascript
{
  status: true
}
```

### 5. 删除轮播图（预期）
```
DELETE /banner/{id}
```

### 6. 上传图片（预期）
```
POST /upload/image
```

#### 请求格式
```
Content-Type: multipart/form-data
```

#### 响应格式
```javascript
{
  fileId: 100,
  fileUrl: "https://example.com/images/xxx.jpg"
}
```

## 💻 前端实现

### API 接口封装 (`src/api/banner.js`)

```javascript
import request from '@/utils/request'

// 获取轮播图列表
export function getBannerList(params) {
  return request({
    url: '/banner/list',
    method: 'get',
    params
  })
}

// 新增轮播图
export function addBanner(data) {
  return request({
    url: '/banner/add',
    method: 'post',
    data
  })
}

// 更新轮播图
export function updateBanner(data) {
  return request({
    url: '/banner/update',
    method: 'put',
    data
  })
}

// 更新状态
export function updateBannerStatus(data) {
  return request({
    url: `/banner/status/${data.id}`,
    method: 'put',
    data: { status: data.status }
  })
}

// 删除轮播图
export function deleteBanner(id) {
  return request({
    url: `/banner/${id}`,
    method: 'delete'
  })
}

// 上传图片
export function uploadBannerImage(formData) {
  return request({
    url: '/upload/image',
    method: 'post',
    data: formData,
    headers: {
      'Content-Type': 'multipart/form-data'
    }
  })
}
```

### 页面实现 (`src/views/content/banner.vue`)

#### 数据加载
```javascript
const loadBannerList = async () => {
  loading.value = true
  try {
    const params = {
      page: pagination.page,
      pageSize: pagination.pageSize,
      ...searchForm
    }
    
    const data = await getBannerList(params)
    
    if (data && data.list) {
      bannerList.value = data.list
      pagination.total = data.total
    }
  } catch (error) {
    console.error('获取轮播图列表失败：', error)
  } finally {
    loading.value = false
  }
}
```

#### 状态切换
```javascript
const handleStatusChange = async (row) => {
  try {
    await updateBannerStatus({
      id: row.id,
      status: row.status
    })
    ElMessage.success(`轮播图状态已${row.status ? '启用' : '禁用'}`)
  } catch (error) {
    row.status = !row.status  // 恢复原状态
    console.error('更新状态失败：', error)
  }
}
```

#### 删除操作
```javascript
const handleDelete = (row) => {
  ElMessageBox.confirm(`确定要删除轮播图 "${row.title}" 吗？`, '提示')
    .then(async () => {
      await deleteBanner(row.id)
      ElMessage.success('删除成功')
      loadBannerList()
    })
}
```

#### 图片上传
```javascript
const handleUpload = async ({ file }) => {
  try {
    const formData = new FormData()
    formData.append('file', file)
    
    const result = await uploadBannerImage(formData)
    
    bannerForm.fileId = result.fileId
    bannerForm.filePathUrl = result.fileUrl
    
    ElMessage.success('图片上传成功')
  } catch (error) {
    ElMessage.error('图片上传失败，请重试')
  }
}
```

#### 提交表单
```javascript
const handleSubmit = async () => {
  await bannerFormRef.value.validate()
  submitLoading.value = true

  const data = {
    title: bannerForm.title,
    fileId: bannerForm.fileId,
    status: bannerForm.status
  }

  if (bannerForm.id) {
    data.id = bannerForm.id
    await updateBanner(data)
    ElMessage.success('编辑成功')
  } else {
    await addBanner(data)
    ElMessage.success('新增成功')
  }
  
  dialogVisible.value = false
  loadBannerList()
}
```

## 📊 字段对应关系

### 后端 → 前端

| 后端字段 | 前端使用 | 说明 |
|---------|---------|------|
| `id` | `row.id` | 轮播图ID |
| `fileId` | `bannerForm.fileId` | 文件ID（用于提交） |
| `filePathUrl` | `row.filePathUrl` | 图片URL（用于显示） |
| `title` | `row.title` | 标题 |
| `status` | `row.status` | 状态开关 |
| `createTime` | `formatTime(row.createTime)` | 创建时间 |
| `updateTime` | `formatTime(row.updateTime)` | 更新时间 |

### 表单提交数据

#### 新增
```javascript
{
  title: "轮播图标题",
  fileId: 100,
  status: true
}
```

#### 编辑
```javascript
{
  id: 1,
  title: "轮播图标题",
  fileId: 100,
  status: true
}
```

## 🎯 简化的功能

基于后端提供的字段，前端进行了以下简化：

### 移除的字段
- ❌ `description`（描述）- 后端未提供
- ❌ `position`（位置）- 后端未提供
- ❌ `linkUrl`（跳转链接）- 后端未提供
- ❌ `viewCount`（浏览量）- 后端未提供
- ❌ `clickCount`（点击量）- 后端未提供
- ❌ `sort`（排序）- 后端未提供

### 移除的功能
- ❌ 位置筛选
- ❌ 排序上下移按钮
- ❌ 浏览量和点击量统计

### 保留的核心功能
- ✅ 轮播图列表展示
- ✅ 标题搜索
- ✅ 状态筛选
- ✅ 新增轮播图
- ✅ 编辑轮播图
- ✅ 删除轮播图
- ✅ 状态切换
- ✅ 图片上传
- ✅ 分页功能

## 📋 表格字段

| 列名 | 宽度 | 说明 | 功能 |
|------|------|------|------|
| ID | 80px | 轮播图ID | - |
| 预览 | 200px | 图片预览 | 点击放大 |
| 标题 | 自适应 | 轮播图标题 | - |
| 创建时间 | 180px | 创建时间 | 格式化显示 |
| 更新时间 | 180px | 更新时间 | 格式化显示 |
| 状态 | 90px | 启用/禁用 | 开关控制 |
| 操作 | 200px | 操作按钮 | 查看/编辑/删除 |

## 🎨 操作按钮

### 3个操作按钮

| 按钮 | 颜色 | 图标 | 功能 |
|------|------|------|------|
| 🔵 查看 | 紫色渐变 | View | 查看详情 |
| 🟡 编辑 | 粉色渐变 | Edit | 编辑轮播图 |
| 🔴 删除 | 橙色渐变 | Delete | 删除轮播图 |

## 🔍 搜索功能

### 搜索条件

| 字段 | 类型 | 宽度 | 说明 |
|------|------|------|------|
| 标题 | 输入框 | 200px | 模糊搜索 |
| 状态 | 下拉框 | 120px | 精确匹配 |

### 搜索逻辑
```javascript
const handleSearch = () => {
  pagination.page = 1  // 重置到第一页
  loadBannerList()     // 重新加载数据
}
```

## 📝 表单字段

### 新增/编辑轮播图

| 字段 | 类型 | 必填 | 验证规则 |
|------|------|------|----------|
| 标题 | 文本输入 | ✅ 是 | 2-50字符 |
| 图片 | 图片上传 | ✅ 是 | JPG/PNG，≤2MB |
| 状态 | 开关 | ✅ 是 | true/false |

## 🔧 图片上传

### 上传流程
```
1. 用户选择图片
   ↓
2. beforeUpload 验证（格式、大小）
   ↓
3. handleUpload 上传到服务器
   ↓
4. 获取 fileId 和 fileUrl
   ↓
5. 保存到表单
   ↓
6. 显示预览
```

### 上传限制
- ✅ 格式：JPG、PNG
- ✅ 大小：≤2MB
- ✅ 建议尺寸：1920x600px

### 上传代码
```javascript
const handleUpload = async ({ file }) => {
  const formData = new FormData()
  formData.append('file', file)
  
  const result = await uploadBannerImage(formData)
  
  bannerForm.fileId = result.fileId        // 保存文件ID（提交用）
  bannerForm.filePathUrl = result.fileUrl   // 保存文件URL（预览用）
}
```

## ⚙️ 代理配置

### Vite 代理设置
```javascript
// vite.config.js
export default defineConfig({
  server: {
    proxy: {
      '/api': {
        target: 'http://localhost:8801',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '')
      }
    }
  }
})
```

### 请求示例
```javascript
// 前端请求
GET /api/banner/list?page=1&pageSize=10

// 实际请求
GET http://localhost:8801/banner/list?page=1&pageSize=10
```

## 🎯 数据流

### 列表加载
```
页面加载 
  → loadBannerList()
  → getBannerList(params)
  → GET /api/banner/list
  → 后端返回 PageInfo<BannerResponse>
  → 前端提取 data.list 和 data.total
  → 更新表格和分页
```

### 状态切换
```
点击开关
  → handleStatusChange(row)
  → updateBannerStatus({ id, status })
  → PUT /api/banner/status/{id}
  → 成功提示
  → 失败则恢复原状态
```

### 删除操作
```
点击删除
  → 确认对话框
  → handleDelete(row)
  → deleteBanner(id)
  → DELETE /api/banner/{id}
  → 成功后重新加载列表
```

### 新增/编辑
```
填写表单
  → 上传图片 → 获取 fileId
  → 提交表单
  → addBanner(data) 或 updateBanner(data)
  → POST/PUT /api/banner/add 或 /update
  → 成功后关闭对话框
  → 重新加载列表
```

## ✅ 对接检查清单

- [x] 创建 API 接口文件
- [x] 实现获取列表接口
- [x] 实现新增接口
- [x] 实现编辑接口
- [x] 实现删除接口
- [x] 实现状态更新接口
- [x] 实现图片上传接口
- [x] 对接分页数据（PageInfo）
- [x] 字段名称匹配（filePathUrl）
- [x] 时间格式化显示
- [x] 错误处理
- [x] 加载状态显示
- [x] 成功/失败提示

## 📄 文件清单

### 新增文件
- ✅ `src/api/banner.js` - 轮播图API接口
- ✅ `轮播图接口对接说明.md` - 接口对接文档

### 修改文件
- ✅ `src/views/content/banner.vue` - 轮播图管理页面（对接后端）

## 🚀 测试步骤

### 1. 启动后端
```bash
# 确保后端服务运行在 8801 端口
java -jar your-backend.jar
```

### 2. 启动前端
```bash
npm run dev
```

### 3. 访问页面
```
http://localhost:3000/content/banner
```

### 4. 测试功能
- ✅ 列表加载
- ✅ 搜索筛选
- ✅ 新增轮播图（需要上传接口）
- ✅ 编辑轮播图（需要更新接口）
- ✅ 状态切换（需要状态接口）
- ✅ 删除轮播图（需要删除接口）
- ✅ 分页功能

## ⚠️ 注意事项

### 1. 接口完整性
目前只实现了 `/banner/list` 接口，其他接口（新增、编辑、删除、状态更新、图片上传）需要后端补充实现。

### 2. 图片上传
需要确认后端图片上传接口的：
- URL 路径
- 请求格式
- 响应格式（fileId 和 fileUrl 字段名）

### 3. 状态更新
需要确认状态更新接口的URL和参数格式。

### 4. 时间格式
后端返回 `LocalDateTime` 格式，前端使用 `formatTime` 函数格式化为 `YYYY-MM-DD HH:mm` 格式。

## 💡 后续优化建议

### 1. 批量操作
- 批量启用/禁用
- 批量删除

### 2. 排序功能
- 拖拽排序
- 上下移动

### 3. 数据统计
- 浏览量统计
- 点击量统计

### 4. 更多字段
- 跳转链接
- 展示位置
- 轮播图描述

---

**轮播图接口对接完成！** 🎠✨

