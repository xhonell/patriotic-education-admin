# 记住密码功能说明 🔐

## 📋 功能概述

在登录页面中实现了"记住密码"功能，当用户勾选"记住密码"选项后，系统会将邮箱和密码保存到本地存储（localStorage），下次访问登录页面时自动填充账号和密码。

## 🎯 核心功能

### 1. **记住密码**
- ✅ 勾选"记住密码"后，登录成功时保存邮箱和密码
- ✅ 密码使用 Base64 编码存储（非明文）
- ✅ 取消勾选时，清除保存的密码

### 2. **自动填充**
- ✅ 页面加载时自动读取保存的账号密码
- ✅ 自动填充到登录表单
- ✅ 自动勾选"记住密码"选项

### 3. **安全性**
- ✅ 密码使用 Base64 编码（简单加密）
- ✅ 可升级为更强的加密方式
- ✅ 取消勾选时自动清除

## 💻 技术实现

### 1. 密码加密/解密

#### Base64 编码
```javascript
// 加密密码
const encryptPassword = (password) => {
  try {
    return btoa(encodeURIComponent(password))
  } catch (e) {
    return password
  }
}

// 解密密码
const decryptPassword = (encrypted) => {
  try {
    return decodeURIComponent(atob(encrypted))
  } catch (e) {
    return encrypted
  }
}
```

#### 为什么使用 Base64？
- ✅ 简单易实现
- ✅ 浏览器原生支持
- ✅ 不需要额外依赖
- ⚠️ 注意：Base64 不是真正的加密，只是编码

### 2. 保存凭据

#### 登录成功时保存
```javascript
const handleLogin = async () => {
  // ... 登录逻辑
  
  if (loginForm.remember) {
    // 保存邮箱和加密后的密码
    localStorage.setItem('savedEmail', loginForm.email)
    localStorage.setItem('savedPassword', encryptPassword(loginForm.password))
  } else {
    // 清除保存的凭据
    localStorage.removeItem('savedEmail')
    localStorage.removeItem('savedPassword')
  }
}
```

### 3. 读取凭据

#### 页面加载时自动填充
```javascript
const loadSavedCredentials = () => {
  const savedEmail = localStorage.getItem('savedEmail')
  const savedPassword = localStorage.getItem('savedPassword')
  
  if (savedEmail && savedPassword) {
    loginForm.email = savedEmail
    loginForm.password = decryptPassword(savedPassword)
    loginForm.remember = true
  }
}

onMounted(() => {
  loadSavedCredentials()
})
```

## 📊 数据流

### 保存流程
```
用户勾选"记住密码"
    ↓
输入邮箱和密码
    ↓
点击登录
    ↓
登录成功
    ↓
检查 remember 状态
    ↓
保存邮箱（明文）
保存密码（Base64 编码）
    ↓
localStorage.setItem('savedEmail', email)
localStorage.setItem('savedPassword', encrypted)
```

### 读取流程
```
打开登录页面
    ↓
onMounted 钩子执行
    ↓
读取 localStorage
    ↓
savedEmail = localStorage.getItem('savedEmail')
savedPassword = localStorage.getItem('savedPassword')
    ↓
如果存在保存的数据
    ↓
解密密码
    ↓
填充到表单
loginForm.email = savedEmail
loginForm.password = decryptPassword(savedPassword)
loginForm.remember = true
```

## 🔒 安全性考虑

### 当前方案：Base64 编码
```javascript
// 原始密码
password = "123456"

// Base64 编码后
encrypted = "MTIzNDU2"

// 存储在 localStorage
localStorage.setItem('savedPassword', 'MTIzNDU2')
```

#### 优点
- ✅ 简单实现
- ✅ 无需依赖
- ✅ 比明文好

#### 缺点
- ⚠️ 不是真正的加密
- ⚠️ 容易被解码
- ⚠️ 不够安全

### 升级方案：AES 加密

如果需要更高的安全性，可以使用 AES 加密：

```javascript
// 安装依赖
npm install crypto-js

// 引入
import CryptoJS from 'crypto-js'

// 加密密钥（应该是随机生成的）
const SECRET_KEY = 'your-secret-key-here'

// 加密
const encryptPassword = (password) => {
  return CryptoJS.AES.encrypt(password, SECRET_KEY).toString()
}

// 解密
const decryptPassword = (encrypted) => {
  const bytes = CryptoJS.AES.decrypt(encrypted, SECRET_KEY)
  return bytes.toString(CryptoJS.enc.Utf8)
}
```

## 📝 使用说明

### 1. 首次登录
```
步骤：
1. 输入邮箱：user@example.com
2. 输入密码：123456
3. 勾选"记住密码"
4. 点击登录
5. 登录成功后，邮箱和密码会被保存
```

### 2. 再次访问
```
步骤：
1. 打开登录页面
2. 邮箱和密码自动填充 ✅
3. "记住密码"自动勾选 ✅
4. 直接点击登录即可
```

### 3. 取消记住密码
```
步骤：
1. 取消勾选"记住密码"
2. 重新登录
3. 保存的邮箱和密码会被清除
4. 下次访问需要重新输入
```

## 🎨 用户界面

### 记住密码复选框
```vue
<el-checkbox v-model="loginForm.remember">
  记住密码
</el-checkbox>
```

### 表单状态

#### 未保存时
```
邮箱：[___________________]
密码：[___________________]
☐ 记住密码
```

#### 已保存时（自动填充）
```
邮箱：[user@example.com___]  ← 自动填充
密码：[●●●●●●●●●●●●●●●●●]  ← 自动填充
☑ 记住密码                    ← 自动勾选
```

## 🔧 localStorage 存储

### 存储的键值对

| 键 | 值 | 说明 |
|---|---|---|
| `savedEmail` | `user@example.com` | 用户邮箱（明文） |
| `savedPassword` | `MTIzNDU2` | 密码（Base64 编码） |

### 查看存储的数据
```javascript
// 在浏览器控制台执行
console.log('保存的邮箱：', localStorage.getItem('savedEmail'))
console.log('保存的密码（加密）：', localStorage.getItem('savedPassword'))

// 解密密码
const encrypted = localStorage.getItem('savedPassword')
const decrypted = decodeURIComponent(atob(encrypted))
console.log('解密后的密码：', decrypted)
```

### 清除保存的数据
```javascript
// 手动清除
localStorage.removeItem('savedEmail')
localStorage.removeItem('savedPassword')

// 或者取消勾选"记住密码"后重新登录
```

## ⚠️ 注意事项

### 1. 安全性
- ⚠️ Base64 编码不是真正的加密
- ⚠️ 任何人都可以通过浏览器控制台查看 localStorage
- ⚠️ 不建议在公共计算机上使用"记住密码"
- ⚠️ 重要账号建议不要勾选"记住密码"

### 2. 隐私保护
- 🔒 建议在个人设备上使用
- 🔒 定期清理浏览器缓存
- 🔒 退出登录时可选择清除记住的密码

### 3. 浏览器兼容性
- ✅ 所有现代浏览器都支持 localStorage
- ✅ Base64 编码（btoa/atob）是浏览器原生 API
- ✅ 无需考虑兼容性问题

## 🎯 实际应用场景

### 适合使用
- ✅ 个人电脑
- ✅ 个人手机
- ✅ 可信任的设备
- ✅ 低敏感度账号

### 不适合使用
- ❌ 公共电脑（网吧、图书馆）
- ❌ 共享设备
- ❌ 高敏感度账号（银行、管理员）
- ❌ 临时使用的设备

## 📊 完整代码示例

### 登录页面关键代码
```vue
<script>
import { ref, reactive, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage } from 'element-plus'
import { login, getUserInfo } from '@/api/login'

export default {
  name: 'Login',
  setup() {
    const loginForm = reactive({
      email: '',
      password: '',
      remember: false  // 默认不勾选
    })

    // 密码加密
    const encryptPassword = (password) => {
      return btoa(encodeURIComponent(password))
    }

    // 密码解密
    const decryptPassword = (encrypted) => {
      return decodeURIComponent(atob(encrypted))
    }

    // 加载保存的凭据
    const loadSavedCredentials = () => {
      const savedEmail = localStorage.getItem('savedEmail')
      const savedPassword = localStorage.getItem('savedPassword')
      
      if (savedEmail && savedPassword) {
        loginForm.email = savedEmail
        loginForm.password = decryptPassword(savedPassword)
        loginForm.remember = true
      }
    }

    // 登录处理
    const handleLogin = async () => {
      // ... 登录逻辑
      
      // 记住密码
      if (loginForm.remember) {
        localStorage.setItem('savedEmail', loginForm.email)
        localStorage.setItem('savedPassword', encryptPassword(loginForm.password))
      } else {
        localStorage.removeItem('savedEmail')
        localStorage.removeItem('savedPassword')
      }
    }

    // 页面加载时读取
    onMounted(() => {
      loadSavedCredentials()
    })

    return {
      loginForm,
      handleLogin
    }
  }
}
</script>
```

## ✅ 功能清单

- [x] 记住密码勾选框
- [x] 登录成功时保存邮箱
- [x] 登录成功时保存密码（Base64 编码）
- [x] 取消勾选时清除保存的数据
- [x] 页面加载时自动读取保存的数据
- [x] 自动填充邮箱
- [x] 自动填充密码（解密）
- [x] 自动勾选"记住密码"
- [x] 错误处理（try-catch）
- [x] 编码/解码异常处理

## 🔄 与其他功能的配合

### 1. 退出登录
```javascript
// 可选：退出登录时清除记住的密码
const handleLogout = () => {
  localStorage.removeItem('token')
  localStorage.removeItem('userInfo')
  // 可选：清除记住的密码
  // localStorage.removeItem('savedEmail')
  // localStorage.removeItem('savedPassword')
  router.push('/login')
}
```

### 2. 修改密码后
```javascript
// 修改密码后，更新保存的密码
const handlePasswordChange = (newPassword) => {
  const remember = localStorage.getItem('savedEmail') ? true : false
  if (remember) {
    localStorage.setItem('savedPassword', encryptPassword(newPassword))
  }
}
```

## 🚀 使用测试

### 测试步骤
```
1. 打开登录页面
   → 表单应该是空的

2. 输入测试账号
   → 邮箱：test@example.com
   → 密码：123456
   → 勾选"记住密码"

3. 点击登录
   → 登录成功

4. 退出登录

5. 重新打开登录页面
   → 邮箱自动填充：test@example.com ✅
   → 密码自动填充：●●●●●● ✅
   → "记住密码"自动勾选 ✅

6. 取消勾选"记住密码"
   → 重新登录

7. 再次打开登录页面
   → 表单应该是空的 ✅
```

## 💡 优化建议

### 1. 安全性升级
使用 crypto-js 实现 AES 加密

### 2. 过期时间
设置保存的密码有效期（如 7 天）

### 3. 设备绑定
将保存的密码与设备指纹绑定

### 4. 二次验证
敏感操作时要求重新输入密码

---

**记住密码功能已完成！** 🔐✨

**安全提示**：
- 建议只在个人设备上使用
- 重要账号请谨慎使用此功能
- 定期清理浏览器数据

